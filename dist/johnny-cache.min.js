function JohnnyCache(){}JohnnyCache.prototype={get(a,b,c){var d=null;try{d=this._store.getItem(this.prefix+'-'+a)}catch(a){console.error(a)}return null===d?'undefined'==typeof b?null:b:(c||this._setRead(a),JSON.parse(d).val)},set(a,b,c){var d=new Date;try{this._store.setItem(this.prefix+'-'+a,JSON.stringify({val:b}))}catch(a){console.error(a)}return this._metaExists(a)?!c&&this._setUpdated(a,d):this._createMeta(a,d),this},has(a){return null!==this.get(a,null,!0)},remove(a){try{this._store.removeItem(this.prefix+'-'+a),this.meta.delete(a),this._delaySaveMeta()}catch(a){console.error(a)}return this._dirty=!0,this},take(a){var b=this.get(a);return this.remove(a),b},all(){return this._resetFilters(),this},createdBefore(a){var b=a?this._date(a):null;return b!==this._createdBefore&&(this._createdBefore=b,this._dirty=!0),this},createdAfter(a){var b=a?this._date(a):null;return b!==this._createdAfter&&(this._createdAfter=b,this._dirty=!0),this},readBefore(a){var b=a?this._date(a):null;return b!==this._readBefore&&(this._readBefore=b,this._dirty=!0),this},readAfter(a){var b=a?this._date(a):null;return b!==this._readAfter&&(this._readAfter=b,this._dirty=!0),this},updatedBefore(a){var b=a?this._date(a):null;return b!==this._updatedBefore&&(this._updatedBefore=b,this._dirty=!0),this},updatedAfter(a){var b=a?this._date(a):null;return b!==this._updatedAfter&&(this._updatedAfter=b,this._dirty=!0),this},filterUsing(a){return this._filterFn=a,this._dirty=!0,this},get isFiltered(){return this._createdBefore||this._createdAfter||this._readBefore||this._readAfter||this._updatedBefore||this._updatedAfter||this._filterFn},get matches(){if(this._dirty){this._matches=new Map;for(var[a,b]of this.meta)(!this._filterFn||'function'!=typeof this._filterFn||this._filterFn(a,this.get(a,null,!0),{created:b.c,read:b.r,updated:b.u}))&&(this._createdBefore&&b.c>=this._createdBefore||this._createdAfter&&b.c<=this._createdAfter||this._readBefore&&b.r>=this._readBefore||this._readAfter&&b.r<=this._readAfter||this._updatedBefore&&b.u>=this._updatedBefore||this._updatedAfter&&b.u<=this._updatedAfter||this._matches.set(a,this.get(a,null,!0)));this._dirty=!1}return this._matches},forEach(a,b){return this.matches.forEach(a,b),this},entries(){return this.matches.entries()},keys(){return this.matches.keys()},values(){return this.matches.values()},clear(){for(var a of this.matches)this.remove(a);return this},[Symbol.iterator]:function*(){for(var[a,b]of this.matches)yield[a,b];return null},get length(){return this.matches.size},get stats(){var a=5120,b=0,c=0,d=0,e=0,f=0;for(var g in this._store)f=2*this._store[g].length/1024,c+=f,e++,g.substring(0,this.prefix.length)===this.prefix&&(b+=f,d++);return{size:{total:a+' KB',used:c+' KB',available:a-c+' KB',JohnnyCache:b+' KB',other:c-b+' KB'},entries:{total:e,JohnnyCache:d,other:e-d}}},_initMeta(){this.metaTimeout=null,'undefined'!=typeof this.meta&&this.meta instanceof Map?this.meta.clear():this.meta=new Map;try{var a=this._store.getItem(this.prefix+'m');if(a){a=JSON.parse(a);for(var b=0;b<a.length;b++)this.meta.set(a[b].k,{c:a[b].c?new Date(a[b].c):a[b].c,r:a[b].r?new Date(a[b].r):a[b].r,u:a[b].u?new Date(a[b].u):a[b].u})}else this._store.setItem(this.prefix+'m','[]')}catch(a){console.error(a)}},_getMeta(a){var b=this.meta.get(a);return void 0===b?null:b},_metaExists(a){return this.meta.has(a)},_updateMeta(a,b,c){var d=this._getMeta(a);return d&&(c=this._date(c),d[b]=c,this._delaySaveMeta(),this._dirty=!0),this},_delaySaveMeta(){this.metaTimeout=window.setTimeout(this._saveMeta.bind(this),this.metaDelay)},_saveMeta(){var a=[];for(var[b,c]of this.meta)a.push({k:b,c:c.c instanceof Date?c.c.valueOf():c.c,r:c.r instanceof Date?c.r.valueOf():c.r,u:c.u instanceof Date?c.u.valueOf():c.u});try{this._store.setItem(this.prefix+'m',JSON.stringify(a))}catch(a){console.error(a)}},_createMeta(a,b){this.meta.set(a,{r:null,c:b,u:b}),this._delaySaveMeta(),this._dirty=!0},_date(a){return a instanceof Date||('undefined'==typeof a?a=new Date:a=new Date(a)),a},_setRead(a,b){return this._updateMeta(a,'r',b)},_setUpdated(a,b){return this._updateMeta(a,'u',b)},_setCreated(a,b){return this._updateMeta(a,'c',b)},_resetFilters(){this.isFiltered&&(this._readBefore=null,this._readAfter=null,this._createdBefore=null,this._createdAfter=null,this._updatedBefore=null,this._updatedAfter=null,this._filterFn=null,this._dirty=!0)}};function init(){if(window&&window.localStorage){var a=new JohnnyCache;return a.prefix='J$',a.metaDelay=1e3,a._store=window.localStorage,a._matches=null,a._dirty=!0,a._initMeta(),a._resetFilters(),a}return null}export default init;